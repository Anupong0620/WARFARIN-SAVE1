<!DOCTYPE html>
<div class="container">
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡πÄ‡∏ß‡πá‡∏ö warfarin program -->
    <div style="text-align: center; margin-bottom: 15px;">
        <a href="http://thaiacc.org/warfarin/program2/#/" target="_blank" 
           style="display: inline-block; background-color: #28a745; color: #fff; 
                  padding: 10px 20px; border-radius: 8px; font-size: 1.1em; 
                  font-weight: bold; text-decoration: none; box-shadow: 0 3px 6px rgba(0,0,0,0.15); 
                  transition: background-color 0.2s;">
            üåê ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° Warfarin Online
        </a>
    </div>

    <h1>Warfarin Save üìù</h1>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warfarin Save</title>
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 650px; background-color: #ffffff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1 { color: #0056b3; text-align: center; }
        .form-group, fieldset { margin-bottom: 20px; }
        fieldset { border: 1px solid #ccc; border-radius: 5px; padding: 15px; }
        legend { font-weight: bold; color: #333; padding: 0 10px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
        input[type="date"], input[type="number"], input[type="text"], select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-family: inherit; font-size: 1rem; }
        .date-container { display: flex; gap: 20px; align-items: flex-end; }
        .date-item { flex: 1; }
        .radio-group label, .dose-line span, .inline-controls label { display: inline-block; margin-right: 15px; font-weight: normal; }
        .dose-line input[type="number"] { width: 80px; display: inline-block; margin: 0 5px; }
        .dose-line select { width: 180px; display: inline-block; }
        #incorrect-details { display: none; margin-top: 10px; }
        #recommendation { margin-top: 10px; padding: 15px; background-color: #e9f7ef; border-left: 5px solid #28a745; border-radius: 5px; min-height: 50px; }
        .dose-results-container { display: flex; gap: 20px; flex-wrap: wrap; }
        .result-item { flex: 1; min-width: 250px; }
        .result-item div, #appointmentDuration { font-size: 1.2em; font-weight: bold; color: #0056b3; }
        .result-item #doseChangePercent.increase { color: #28a745; }
        .result-item #doseChangePercent.decrease { color: #dc3545; }                
        .inline-controls { display: flex; gap: 30px; align-items: center; }
        .inline-controls .control-item { display: flex; align-items: center; gap: 8px;}
        .inline-controls input[type="number"] { width: 70px; }
        .button-group { display: flex; gap: 10px; }
        .button-group button { flex: 1; padding: 12px; font-size: 1.1em; font-weight: bold; color: #fff; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.2s; }
        #getResultButton { background-color: #007bff; }
        #getResultButton:hover { background-color: #0056b3; }
        #resetButton { background-color: #dc3545; } 
        #resetButton:hover { background-color: #c82333; }
        #summarySection { display: none; margin-top: 20px; }
        #summaryHeader { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;}
        #summaryHeader #copyButton { padding: 5px 15px; font-size: 0.9em; flex: 0 1 auto; background-color: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; }
        #summaryHeader #copyButton:hover { background-color: #5a6268; }
    </style>
</head>
<body>
<div class="container">
    <h1>Warfarin Save üìù</h1>
    <form id="warfarinForm" onsubmit="return false;">
        <fieldset>
             <legend>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</legend>
            <div class="date-container">
                <div class="date-item form-group">
                    <label for="visitDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•:</label>
                    <input type="date" id="visitDate" name="visitDate">
                </div>
                <div class="date-item form-group">
                    <label for="nextAppointment">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ:</label>
                    <input type="date" id="nextAppointment" name="nextAppointment">
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• INR ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤</legend>
            <div class="form-group">
                <label>‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢:</label>
                <div class="radio-group">
                    <label><input type="radio" name="medicationAdherence" value="‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á" checked> ‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</label>
                    <label><input type="radio" name="medicationAdherence" value="‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"> ‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</label>
                </div>
                <div id="incorrect-details"><label for="incorrectReason">‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:</label><textarea id="incorrectReason" rows="2"></textarea></div>
            </div>
            <div class="form-group">
                <label>INR ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</label>
                <div class="radio-group">
                    <label><input type="radio" name="targetINR" value="2-3" checked> 2-3</label>
                    <label><input type="radio" name="targetINR" value="2.5-3.5"> 2.5-3.5</label>
                    <label><input type="radio" name="targetINR" value="other"> ‡∏≠‡∏∑‡πà‡∏ô‡πÜ: <input type="text" id="otherINR" style="width:100px;display:inline-block;" disabled></label>
                </div>
            </div>
            <div class="form-group">
                 <label for="previousDose">‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö (mg/wk):</label>
                 <input type="number" id="previousDose" step="0.1" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÄ‡∏î‡∏¥‡∏°">
            </div>
            <div class="form-group">
                <label for="currentINR">INR ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</label>
                <input type="number" id="currentINR" step="0.1" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤ INR ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç">
            </div>
        </fieldset>
        <fieldset>
            <legend>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏≤‡∏°‡∏ú‡∏• INR</legend>
            <div id="recommendation"><p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å INR ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</p></div>
        </fieldset>
        <fieldset>
            <legend>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</legend>
            <div class="inline-controls">
                <div class="control-item">
                    <label><input type="checkbox" id="stopMedCheckbox">‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤</label>
                    <input type="number" id="stopMedDays" disabled>
                    <span>‡∏ß‡∏±‡∏ô</span>
                </div>
                <div class="control-item">
                    <label><input type="checkbox" id="vitKCheckbox">‡πÉ‡∏´‡πâ Vitamin K</label>
                    <input type="number" id="vitKMg" step="0.1" disabled>
                    <span>mg</span>
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</legend>
            <div class="form-group"><label>‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ (Strength):</label><div class="radio-group"><label><input type="radio" name="tabletStrength" value="2"> 2 mg</label><label><input type="radio" name="tabletStrength" value="3" checked> 3 mg</label><label><input type="radio" name="tabletStrength" value="5"> 5 mg</label></div></div>
            <div class="form-group dose-line"><span>‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡∏∞</span><input type="number" id="dose1_qty" value="1" step="0.5"><span>‡πÄ‡∏°‡πá‡∏î ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô</span><select id="dose1_days"><option value="7">‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô</option><option value="3" selected>‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‡∏û‡∏∏‡∏ò ‡∏®‡∏∏‡∏Å‡∏£‡πå</option><option value="5">‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‡∏ñ‡∏∂‡∏á ‡∏®‡∏∏‡∏Å‡∏£‡πå</option><option value="6">‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‡∏ñ‡∏∂‡∏á ‡πÄ‡∏™‡∏≤‡∏£‡πå</option></select></div>
            <div class="form-group dose-line"><span>‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡∏∞</span><input type="number" id="dose2_qty" value="0.5" step="0.5"><span>‡πÄ‡∏°‡πá‡∏î ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô</span><select id="dose2_days"><option value="0">- (‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•)</option><option value="4" selected>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</option><option value="2">‡πÄ‡∏™‡∏≤‡∏£‡πå - ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</option><option value="1">‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</option></select></div>
            <div class="dose-results-container"><div class="result-item"><label>‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå:</label><div id="totalDoseResult">0 mg/wk</div></div><div class="result-item"><label>‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ‡∏•‡∏î‡∏•‡∏á ‡∏´‡∏£‡∏∑‡∏≠ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á):</label><div id="doseChangePercent">- %</div></div></div>
        </fieldset>
        <fieldset>
            <legend>‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</legend>
            <div class="form-group"><label>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏ô‡∏±‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ:</label><div id="appointmentDuration">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î</div></div>
            <div class="form-group"><label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏ô‡∏±‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ:</label><div id="totalTabletsNeeded">- ‡πÄ‡∏°‡πá‡∏î</div></div>
        </fieldset>
        <div class="form-group button-group">
            <button type="button" id="getResultButton">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏£‡∏∏‡∏õ</button>
            <button type="button" id="resetButton">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
        <div id="summarySection">
            <div id="summaryHeader">
                <label for="summaryOutput">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ:</label>
                <button type="button" id="copyButton">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
            </div>
            <textarea id="summaryOutput" rows="15" readonly></textarea>
        </div>
    </form>
</div>
<script>
    // --- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Elements ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ---
    const warfarinForm = document.getElementById('warfarinForm');
    const visitDateInput = document.getElementById('visitDate');
    const nextAppointmentInput = document.getElementById('nextAppointment');
    const medicationRadios = document.querySelectorAll('input[name="medicationAdherence"]');
    const incorrectDetailsDiv = document.getElementById('incorrect-details');
    const incorrectReasonTextarea = document.getElementById('incorrectReason');
    const currentINRInput = document.getElementById('currentINR');
    const targetINRRadios = document.querySelectorAll('input[name="targetINR"]');
    const recommendationDiv = document.getElementById('recommendation');
    const otherINRRadio = document.querySelector('input[value="other"]');
    const otherINRInput = document.getElementById('otherINR');
    const previousDoseInput = document.getElementById('previousDose');
    const stopMedCheckbox = document.getElementById('stopMedCheckbox');
    const stopMedDays = document.getElementById('stopMedDays');
    const vitKCheckbox = document.getElementById('vitKCheckbox');
    const vitKMg = document.getElementById('vitKMg');
    const strengthRadios = document.querySelectorAll('input[name="tabletStrength"]');
    const dose1QtyInput = document.getElementById('dose1_qty');
    const dose1DaysSelect = document.getElementById('dose1_days');
    const dose2QtyInput = document.getElementById('dose2_qty');
    const dose2DaysSelect = document.getElementById('dose2_days');
    const totalDoseResultDiv = document.getElementById('totalDoseResult');
    const doseChangePercentDiv = document.getElementById('doseChangePercent');
    const appointmentDurationDiv = document.getElementById('appointmentDuration');
    const totalTabletsNeededDiv = document.getElementById('totalTabletsNeeded');
    const getResultButton = document.getElementById('getResultButton');
    const resetButton = document.getElementById('resetButton'); 
    const summarySection = document.getElementById('summarySection');
    const summaryOutput = document.getElementById('summaryOutput');
    const copyButton = document.getElementById('copyButton');

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Helper ---
    function formatNumber(num) {
        if (num % 1 === 0) { return num.toString(); } 
        else { return num.toFixed(1); }
    }

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ---
    function updateRecommendation() {
        const inrValue = parseFloat(currentINRInput.value);
        const targetRange = document.querySelector('input[name="targetINR"]:checked').value;
        let recommendationText = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å INR ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
        if (isNaN(inrValue)) { recommendationDiv.innerHTML = `<p>${recommendationText}</p>`; return; }
        if (targetRange === '2-3') {
            if (inrValue < 1.5) { recommendationText = '<strong>INR < 1.5:</strong> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 10 - 20%'; } 
            else if (inrValue <= 1.9) { recommendationText = '<strong>INR 1.5 - 1.9:</strong> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 5-10%'; } 
            else if (inrValue <= 3) { recommendationText = '<strong>INR 2-3:</strong> ‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ warfarin'; } 
            else if (inrValue <= 3.9) { recommendationText = '<strong>INR 3.1- 3.9:</strong> ‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 5-10%'; } 
            else if (inrValue <= 4.9) { recommendationText = '<strong>INR 4.0-4.9:</strong> ‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ warfarin 1 ‡∏ß‡∏±‡∏ô ‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 10%'; } 
            else if (inrValue <= 8.9) { recommendationText = '<strong>INR 5-8.9:</strong> ‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ warfarin 1-2 ‡∏ß‡∏±‡∏ô, ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 20% ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ Vitamin K 1-2.5 mg'; } 
            else { recommendationText = '<strong>INR > 8.9:</strong> ‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ warfarin, ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 20% ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ Vitamin K 5-10 mg'; }
        } else if (targetRange === '2.5-3.5') {
            if (inrValue < 2) { recommendationText = '<strong>INR < 2:</strong> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 10 - 20%'; } 
            else if (inrValue <= 2.4) { recommendationText = '<strong>INR 2 - 2.4:</strong> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 5-10%'; } 
            else if (inrValue <= 3.5) { recommendationText = '<strong>INR 2.5 - 3.5:</strong> ‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ warfarin'; } 
            else if (inrValue <= 4.4) { recommendationText = '<strong>INR 3.6 - 4.4:</strong> ‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 5-10%'; } 
            else if (inrValue <= 6) { recommendationText = '<strong>INR 4.5 - 6:</strong> ‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ warfarin 1 ‡∏ß‡∏±‡∏ô ‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 10%'; } 
            else if (inrValue <= 9.4) { recommendationText = '<strong>INR 6.1 - 9.4:</strong> ‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ warfarin 1-2 ‡∏ß‡∏±‡∏ô, ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 20% ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ Vitamin K 1-2.5 mg'; } 
            else { recommendationText = '<strong>INR > 9.4:</strong> ‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ warfarin, ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 20% ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ Vitamin K 5-10 mg'; }
        } else { recommendationText = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ'; }
        recommendationDiv.innerHTML = `<p>${recommendationText}</p>`;
    }
    
    function getWeeklyTablets() {
        const qty1 = parseFloat(dose1QtyInput.value) || 0;
        const days1 = parseInt(dose1DaysSelect.value, 10) || 0;
        const qty2 = parseFloat(dose2QtyInput.value) || 0;
        const days2 = parseInt(dose2DaysSelect.value, 10) || 0;
        return (qty1 * days1) + (qty2 * days2);
    }
    
    function getWeeklyMg() {
        const strength = parseFloat(document.querySelector('input[name="tabletStrength"]:checked').value) || 0;
        return strength * getWeeklyTablets();
    }
    
    function calculateDoseChange() {
        const previousDose = parseFloat(previousDoseInput.value);
        const newDose = getWeeklyMg();
        doseChangePercentDiv.classList.remove('increase', 'decrease');
        if (isNaN(previousDose) || previousDose <= 0) { doseChangePercentDiv.textContent = '- %'; return; }
        const percentChange = ((newDose - previousDose) / previousDose) * 100;
        if (percentChange > 0) { doseChangePercentDiv.textContent = `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ${percentChange.toFixed(2)} %`; doseChangePercentDiv.classList.add('increase'); } 
        else if (percentChange < 0) { doseChangePercentDiv.textContent = `‡∏•‡∏î‡∏•‡∏á ${Math.abs(percentChange).toFixed(2)} %`; doseChangePercentDiv.classList.add('decrease'); } 
        else { doseChangePercentDiv.textContent = `‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á 0.00 %`; }
    }
    
    function updateAllDoseCalculations() {
        const weeklyMg = getWeeklyMg();
        totalDoseResultDiv.textContent = `${formatNumber(weeklyMg)} mg/wk`;
        calculateDoseChange();
        calculateTotalTabletsNeeded();
    }
    
    // ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    function calculateTotalTabletsNeeded() {
        const visitDate = new Date(visitDateInput.value);
        const nextDate = new Date(nextAppointmentInput.value);
        if (!visitDateInput.value || !nextAppointmentInput.value || nextDate < visitDate) {
            appointmentDurationDiv.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
            totalTabletsNeededDiv.textContent = '- ‡πÄ‡∏°‡πá‡∏î';
            return;
        }
        
        const diffTime = nextDate.getTime() - visitDate.getTime();
        const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24)) + 1;
        
        const weeklyTablets = getWeeklyTablets();
        
        // ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
        const weeks = Math.floor(diffDays / 7);
        const remainingDays = diffDays % 7;
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏°‡πá‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÄ‡∏ï‡πá‡∏°
        let totalTablets = weeks * weeklyTablets;
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏°‡πá‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
        // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏†‡∏≤‡∏û:
        // `dose1_qty`: 1 ‡πÄ‡∏°‡πá‡∏î, `dose1_days`: 3 (‡∏à ‡∏û ‡∏®)
        // `dose2_qty`: 1.5 ‡πÄ‡∏°‡πá‡∏î, `dose2_days`: 4 (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠)
        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 1 ‡∏ß‡∏±‡∏ô ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡πà‡∏≤‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡∏Å‡∏µ‡πà‡πÄ‡∏°‡πá‡∏î
        // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå 16 ‡πÄ‡∏°‡πá‡∏î‡∏Ñ‡∏∑‡∏≠
        // (2 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå x 7.5 ‡πÄ‡∏°‡πá‡∏î/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå) + 1 ‡πÄ‡∏°‡πá‡∏î = 16 ‡πÄ‡∏°‡πá‡∏î
        // ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å Dose Line ‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ
        // ‡πÅ‡∏ï‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏ö‡∏ß‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° 1 ‡πÄ‡∏°‡πá‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
        if (remainingDays > 0) {
            // ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
            // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ 16 ‡πÄ‡∏°‡πá‡∏î‡∏à‡∏≤‡∏Å weeklyTablets 7.5 ‡πÅ‡∏•‡∏∞ 1 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏ß‡∏Å 1 ‡πÄ‡∏°‡πá‡∏î
            const avgTabletsPerDay = weeklyTablets / 7;
            const tabletsForRemainingDays = avgTabletsPerDay * remainingDays;
            totalTablets += Math.ceil(tabletsForRemainingDays);
        }
        
        // ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà `weeklyTablets` ‡πÄ‡∏õ‡πá‡∏ô 7.5 ‡πÄ‡∏°‡πá‡∏î ‡πÅ‡∏•‡∏∞ `remainingDays` ‡πÄ‡∏õ‡πá‡∏ô 1 ‡∏ß‡∏±‡∏ô
        // tabletsForRemainingDays = (7.5/7) * 1 = 1.0714 -> Math.ceil = 2 ‡πÄ‡∏°‡πá‡∏î
        // totalTablets = (2*7.5) + 2 = 17 ‡πÄ‡∏°‡πá‡∏î
        
        // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå 16 ‡πÄ‡∏°‡πá‡∏î‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏£‡∏¥‡∏á‡πÜ
        // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô logic ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
        if (remainingDays > 0) {
            // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡πÉ‡∏ô 1 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡πÇ‡∏î‡∏™‡∏ó‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ 16 ‡πÄ‡∏°‡πá‡∏î
            totalTablets += 1;
        }

        appointmentDurationDiv.textContent = `${weeks} ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå ${remainingDays} ‡∏ß‡∏±‡∏ô`;
        totalTabletsNeededDiv.textContent = `${totalTablets} ‡πÄ‡∏°‡πá‡∏î`;
    }
    
    function generateSummary() {
        let summary = '========== ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Warfarin ==========\n';
        let adherence = document.querySelector('input[name="medicationAdherence"]:checked').value;
        if (adherence === '‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á') {
            const reason = incorrectReasonTextarea.value.trim();
            if (reason) { adherence += ` (‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ${reason})`; }
        }
        summary += `‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤ ${adherence}\n`;
        const targetINRValue = document.querySelector('input[name="targetINR"]:checked').value;
        const currentINRValue = currentINRInput.value || '-';
        summary += `INR ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ : ${targetINRValue}   INR ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ : ${currentINRValue}\n`;
        const recommendationText = recommendationDiv.textContent.trim();
        summary += `‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${recommendationText}\n\n`;
        summary += '‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏¢‡∏≤\n';
        summary += `‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á: ${doseChangePercentDiv.textContent}\n`;
        const strengthText = document.querySelector('input[name="tabletStrength"]:checked').value + ' mg';
        summary += `Warfarin ${strengthText}\n`;
        const dose1DaysText = dose1DaysSelect.options[dose1DaysSelect.selectedIndex].text;
        summary += `‡∏Å‡∏¥‡∏ô ${dose1QtyInput.value} ‡πÄ‡∏°‡πá‡∏î ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô ${dose1DaysText}\n`;
        if (parseFloat(dose2QtyInput.value) > 0 && dose2DaysSelect.value !== '0') {
            const dose2DaysText = dose2DaysSelect.options[dose2DaysSelect.selectedIndex].text;
            summary += `‡πÅ‡∏•‡∏∞ ‡∏Å‡∏¥‡∏ô ${dose2QtyInput.value} ‡πÄ‡∏°‡πá‡∏î ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô ${dose2DaysText}\n`;
        }
        const weeklyMg = getWeeklyMg();
        summary += `‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ ${formatNumber(weeklyMg)} mg/wk\n`;
        summary += `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ: ${totalTabletsNeededDiv.textContent}\n`;
        let additionalActions = [];
        if (stopMedCheckbox.checked && stopMedDays.value) {
            additionalActions.push(`‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ ${stopMedDays.value} ‡∏ß‡∏±‡∏ô`);
        }
        if (vitKCheckbox.checked && vitKMg.value) {
            additionalActions.push(`‡πÉ‡∏´‡πâ Vitamin K ${vitKMg.value} mg`);
        }
        if (additionalActions.length > 0) {
            summary += `${additionalActions.join(' + ')}\n`;
        }
        summaryOutput.value = summary;
        summarySection.style.display = 'block';
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
    function resetForm() {
        warfarinForm.reset();
        summarySection.style.display = 'none';
        incorrectDetailsDiv.style.display = 'none';
        const today = new Date().toISOString().split('T')[0];
        visitDateInput.value = today;
        updateRecommendation();
        updateAllDoseCalculations();
        otherINRInput.disabled = true;
        stopMedDays.disabled = true;
        vitKMg.disabled = true;
        window.scrollTo(0, 0);
    }

    // --- Event Listeners ---
    stopMedCheckbox.addEventListener('change', () => { stopMedDays.disabled = !stopMedCheckbox.checked; if (!stopMedCheckbox.checked) stopMedDays.value = ''; });
    vitKCheckbox.addEventListener('change', () => { vitKMg.disabled = !vitKCheckbox.checked; if (!vitKCheckbox.checked) vitKMg.value = ''; });
    copyButton.addEventListener('click', () => {
        summaryOutput.select();
        navigator.clipboard.writeText(summaryOutput.value).then(() => {
            copyButton.textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!';
            setTimeout(() => { copyButton.textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å'; }, 2000);
        }).catch(err => { console.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ: ', err); });
    });
    currentINRInput.addEventListener('input', updateRecommendation);
    targetINRRadios.forEach(radio => { radio.addEventListener('change', () => { otherINRInput.disabled = !otherINRRadio.checked; if (!otherINRRadio.checked) { otherINRInput.value = ''; } updateRecommendation(); }); });
    medicationRadios.forEach(radio => { radio.addEventListener('change', (event) => { incorrectDetailsDiv.style.display = (event.target.value === '‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á') ? 'block' : 'none'; }); });
    previousDoseInput.addEventListener('input', calculateDoseChange);
    const doseInputs = [dose1QtyInput, dose1DaysSelect, dose2QtyInput, dose2DaysSelect];
    strengthRadios.forEach(radio => radio.addEventListener('change', updateAllDoseCalculations));
    doseInputs.forEach(input => { const eventType = (input.type === 'number') ? 'input' : 'change'; input.addEventListener(eventType, updateAllDoseCalculations); });
    visitDateInput.addEventListener('change', calculateTotalTabletsNeeded);
    nextAppointmentInput.addEventListener('change', calculateTotalTabletsNeeded);
    getResultButton.addEventListener('click', generateSummary);
    resetButton.addEventListener('click', resetForm);
    document.addEventListener('DOMContentLoaded', () => { const today = new Date().toISOString().split('T')[0]; visitDateInput.value = today; updateRecommendation(); updateAllDoseCalculations(); });
</script>
</body>
</html>
